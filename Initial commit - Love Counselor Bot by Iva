import telebot
import os
from huggingface_hub import InferenceClient
from telebot import types

TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
HF_TOKEN = os.getenv('HF_TOKEN')

client = InferenceClient(
    model="Qwen/Qwen3-235B-A22B",
    token=HF_TOKEN
)

bot = telebot.TeleBot(TELEGRAM_BOT_TOKEN)

@bot.message_handler(commands=['start'])
def send_welcome(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn1 = types.KeyboardButton("ğŸ’¬ Ù…Ø´Ø§ÙˆØ±Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† (Û± Ø³ÙˆØ§Ù„)")
    btn2 = types.KeyboardButton("ğŸ’ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© VIP")
    markup.add(btn1, btn2)
    bot.reply_to(message, 
                 "ğŸŒŸ Ø³Ù„Ø§Ù… Ø¹Ø²ÛŒØ²Ù…â€¦ Ù…Ù† Â«Ø§ÛŒÙˆØ§Â» Ù‡Ø³ØªÙ… â€” Ù…Ø´Ø§ÙˆØ±Ù Ø¹Ø´Ù‚Ù ØªÙˆ!\n"
                 "Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¹Ø´Ù‚ØŒ Ø±Ø§Ø¨Ø·Ù‡ØŒ ÛŒØ§ Ù‚Ù„Ø¨Ù Ø´Ú©Ø³ØªÙ‡ Ø¯Ø§Ø±ÛŒ â€” Ù…Ù† Ø§ÛŒÙ†Ø¬Ø§Ù….\n\n"
                 "ğŸ‘‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:",
                 reply_markup=markup)

@bot.message_handler(func=lambda message: True)
def handle_message(message):
    if message.text == "ğŸ’¬ Ù…Ø´Ø§ÙˆØ±Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† (Û± Ø³ÙˆØ§Ù„)":
        bot.reply_to(message, "ğŸ’Œ Ø®Ø¨ Ø¹Ø²ÛŒØ²Ù…â€¦ Ø³ÙˆØ§Ù„Øª Ø±Ùˆ Ø¨Ù¾Ø±Ø³ â€” Ù…Ù† Ø¨Ø§ ØªÙ…Ø§Ù… ÙˆØ¬ÙˆØ¯ Ú¯ÙˆØ´ Ù…ÛŒâ€ŒØ¯Ù… â¤ï¸")
        bot.register_next_step_handler(message, get_answer_from_qwen)
    elif message.text == "ğŸ’ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© VIP":
        bot.reply_to(message, 
                     "âœ¨ Ø§Ø´ØªØ±Ø§Ú© VIP Ø´Ø§Ù…Ù„:\n"
                     "â€¢ Ù…Ø´Ø§ÙˆØ±Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯\n"
                     "â€¢ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡\n"
                     "â€¢ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ Ø¹Ø§Ø´Ù‚Ø§Ù†Ù‡!\n\n"
                     "ğŸ’° Ù‚ÛŒÙ…Øª: ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† Ø¯Ø± Ù…Ø§Ù‡\n"
                     "ğŸ’³ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯: @YourPaymentBot")
    else:
        get_answer_from_qwen(message)

def get_answer_from_qwen(message):
    bot.reply_to(message, "ğŸ§  Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Â«Ø§ÛŒÙˆØ§Â»â€¦ Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†!")
    try:
        response = client.text_generation(
            prompt=f"ØªÙˆ ÛŒÙ‡ Ù…Ø´Ø§ÙˆØ± Ø¹Ø´Ù‚ Ù‡Ø³ØªÛŒ â€” Ø¨Ø§ Ù„Ø­Ù†ÛŒ Ø´ÛŒØ±ÛŒÙ†ØŒ Ø¹Ù…ÛŒÙ‚ Ùˆ Ú©Ù…ÛŒ Ø´ÙˆØ®. Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡:\n{message.text}",
            max_new_tokens=500
        )
        bot.reply_to(message, response)
    except Exception as e:
        bot.reply_to(message, f"âŒ Ø®Ø·Ø§: {str(e)}\nØ¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†!")

if __name__ == "__main__":
    bot.polling()
